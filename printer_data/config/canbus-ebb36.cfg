# This file contains common pin mappings for the BIGTREETECH EBBCan
# Canbus board. To use this config, the firmware should be compiled for the
# STM32G0B1 with "8 MHz crystal" and "USB (on PA11/PA12)" or "CAN bus (on PB0/PB1)".
# The "EBB Can" micro-controller will be used to control the components on the nozzle.

# See docs/Config_Reference.md for a description of parameters.

[mcu EBBCan]
canbus_uuid: 61a043e7a01a # The unique hardware address used to identify and communicate with this specific board

[adxl345]
cs_pin: EBBCan: PB12 # The Chip Select pin used to manage data traffic for the SPI connection
spi_software_sclk_pin: EBBCan: PB10 # The software-defined clock pin that synchronizes data transfer
spi_software_mosi_pin: EBBCan: PB11 # The Master Out Slave In pin used to send commands to the sensor
spi_software_miso_pin: EBBCan: PB2 # The Master In Slave Out pin used to read data back from the sensor
axes_map: x,y,z # Defines the physical orientation of the sensor relative to the printer's axes

[extruder]
step_pin: EBBCan: PD0 # The pin that pulses to move the toolhead's motor (typically the extruder)
dir_pin: !EBBCan: PD1 # The pin that determines movement direction; the '!' sign reverses it
enable_pin: !EBBCan: PD2 # The pin that activates the motor driver; the '!' means it is 'active low'
microsteps: 16 # Defines the number of fractional steps per full motor step for smoother motion
gear_ratio: 50:8 # For Sherpa Mini 8t motor
full_steps_per_rotation: 200 # 1.8deg Motor
rotation_distance: 22.692 # Rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / <requested_extrude_distance> to three decimal places.
nozzle_diameter: 0.400 # The physical diameter of the nozzle's exit hole in millimeters
filament_diameter: 1.750 # The standard diameter of the 3D printing filament being used
heater_pin: EBBCan: PB13 # The pin on the EBB board that controls power to the heater cartridge
sensor_type: ATC Semitec 104NT-4-R025H42G # Specifies the high-temperature thermistor model for accurate readings
sensor_pin: EBBCan: PA3 # The analog input pin on the EBB board that reads the thermistor's resistance
max_extrude_only_distance: 1000 # Allows for long filament loads or unloads without triggering a safety error
control: pid # Sets the Proportional-Integral-Derivative algorithm to maintain stable temperatures
pid_Kp = 20.554
pid_Ki = 1.142
pid_Kd = 92.496
min_temp: 0 # The lowest temperature the printer will allow before triggering a safety shutdown
max_temp: 300 # The maximum safe operating temperature for this hotend assembly
pressure_advance: 0.0324 # Compensates for internal nozzle pressure to prevent oozing and improve corner quality

[tmc2209 extruder]
uart_pin: EBBCan: PA15 # The digital communication pin used to configure driver settings via software
run_current: 0.650 # The amount of electrical current (in Amperes) sent to the extruder motor
stealthchop_threshold: 999999 # Keeps the motor in silent mode regardless of how fast it is moving

[fan]
pin: EBBCan: PA0 # The pin on the EBB board that controls the part cooling fan speed
max_power: 1 # Sets the maximum allowable fan speed to 100% of its rated voltage
kick_start_time: 0.5 # Delivers a full-power burst for 0.5 seconds to help the fan start spinning from a stop
cycle_time: 0.001 # The PWM frequency; 0.001 (1kHz) is standard for high-speed 4-wire or sensitive fans

[heater_fan hotend_fan]
pin: EBBCan: PA1 # The pin on the EBB board that controls the hotend cooling fan
heater: extruder # Links this fan to the extruder heater so it knows when to turn on
heater_temp: 50.0 # The threshold temperature (Celsius) at which the fan automatically starts or stops